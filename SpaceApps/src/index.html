<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>SpaceApps</title>


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="stylesheet" type="text/css" href="assets/jqui/jquery-ui.min.css" />
  <!-- <link rel="stylesheet" type="text/css" href="assets/jqui/jquery-ui.structure.min.css" /> -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="assets/jqui/jquery-ui.min.js"></script>
</head>
<body>
  <!-- http://bl.ocks.org/mbostock/raw/4090846/us.json -->
  <div class="row1"> 
    <fieldset>
      <legend>Select an environmental factor: </legend>
      <label for="checkbox-1">Population Density</label>
      <input type="checkbox" name="checkbox-1" id="checkbox-1">
      <label for="checkbox-2">Tree Distribution</label>
      <input type="checkbox" name="checkbox-2" id="checkbox-2">
      <label for="checkbox-3">Food/Agriculture Migration</label>
      <input type="checkbox" name="checkbox-3" id="checkbox-3">
    </fieldset>
    <div class="block-slider"> 
      <div id="slider">
        <div id="custom-handle" class="ui-slider-handle"></div>
      </div>
    </div>
  </div>

  <div class="row2">
    <div class="svg-image">
      <svg width="640" height="400" viewBox="0 0 960 600" preserveAspectRatio="none"></svg>
    </div>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script>
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var unemployment = d3.map();

    var path = d3.geoPath();

    var x = d3.scaleLinear()
        .domain([1, 10])
        .rangeRound([600, 860]);

    var color = d3.scaleThreshold()
        .domain(d3.range(2, 10))
        .range(d3.schemeBlues[9]);

    var g = svg.append("g")
        .attr("class", "key")
        .attr("transform", "translate(0,40)");

    g.selectAll("rect")
      .data(color.range().map(function(d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = x.domain()[0];
          if (d[1] == null) d[1] = x.domain()[1];
          return d;
        }))
      .enter().append("rect")
        .attr("height", 8)
        .attr("x", function(d) { return x(d[0]); })
        .attr("width", function(d) { return x(d[1]) - x(d[0]); })
        .attr("fill", function(d) { return color(d[0]); });

    g.append("text")
        .attr("class", "caption")
        .attr("x", x.range()[0])
        .attr("y", -6)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
        .text("Population Density");

    g.call(d3.axisBottom(x)
        .tickSize(13)
        .tickFormat(function(x, i) { return i ? x : x + "%"; })
        .tickValues(color.domain()))
      .select(".domain")
        .remove();

    d3.queue()
        .defer(d3.json, "https://d3js.org/us-10m.v1.json")
        //.defer(d3.tsv, "unemployment.tsv", function(d) { unemployment.set(d.id, +d.rate); })
        .await(ready);
    
    var getJson = function() {
      $.ajax({
        'async': false,
        'global': false,
        'url': "./population_data.json",
        'dataType': "json",
        'success': function (data) {
          data = data.zone_human_population;
          data.forEach(function(d) {
            unemployment.set(d.incits_id, +d.population_by_year["2000"]);
          });
        }
      });
    };

    function ready(error, us) {
        console.log("in here");
        
      if (error) throw error;
      getJson();
      svg.append("g")
          .attr("class", "counties")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.counties).features)
        .enter().append("path")
          .attr("fill", function(d) { return color(d.rate = (unemployment.get(d.id) || 0) / 5000); })
          .attr("d", path)
        .append("title")
          .text(function(d) { return d.rate + "%"; });

      svg.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("class", "states")
          .attr("d", path);
    }
    var getJson = function() {
      $.ajax({
        'async': false,
        'global': false,
        'url': "./population_data.json",
        'dataType': "json",
        'success': function (data) {
          data = data.zone_human_population;
          data.forEach(function(d) {
            unemployment.set(d.incits_id, +d.population_by_year["2000"]);
          });
        }
      });
    };
    </script>
  </div>
  <!-- 
  <div class="row3">
    
  </div>
  -->
  <script>
    $( function() {
      var handle = $( "#custom-handle" );
      $( "#slider" ).slider({
        min: 2000,
        max: 2020,
        step: 5,
        create: function() {
          handle.text( $( this ).slider( "value" ) );
        },
        slide: function( event, ui ) {
          handle.text( ui.value );
        }
      });
    } );
    $( function() {
      $( "input" ).checkboxradio();
      $( "fieldset" ).controlgroup();
   });
  </script>
</body>
</html>
